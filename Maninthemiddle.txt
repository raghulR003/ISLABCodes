public class Maninthemiddle {
    private static long power(long x, long y, long z) {
        if (y == 1)
            return x;
        else
            return (long) (Math.pow(x, y) % z);
    }

    private static long calculatePrimitiveRoot(long p) {
        for (int r = 2; r < p; r++) {
            boolean[] set = new boolean[(int) p];
            long val = 1;
            for (int i = 0; i < p - 1; i++) {
                val = (val * r) % p;
                if (set[(int) val]) {
                    break;
                }
                set[(int) val] = true;
            }
            if (val == 1) {
                return r;
            }
        }
        return -1;
    }

    public static void main(String[] args) {
        long p, primitiveRootG, privateA, privateB, privateCtoA, privateCtoB, publicXA, publicYB,
                publicXC, publicYC, secretKeyA, secretKeyB, secretKeyCtoA, secretKeyCtoB;
        java.util.Scanner sc = new java.util.Scanner(System.in);
        System.out.print("Enter a prime number p: ");
        p = sc.nextLong();
        System.out.println("Prime number p: " + p);
        primitiveRootG = calculatePrimitiveRoot(p);
        if (primitiveRootG == -1) {
            System.out.println("No primitive root found for p.");
            return;
        }
        System.out.println("Primitive root G: " + primitiveRootG);
        System.out.print("Enter private key for A: ");
        privateA = sc.nextLong();
        System.out.println("A's private key a: " + privateA);
        System.out.print("Enter private key for B: ");
        privateB = sc.nextLong();
        System.out.println("B's private key b: " + privateB);
        System.out.print("Enter private key for C to A: ");
        privateCtoA = sc.nextLong();
        System.out.println("C's private key c to A: " + privateCtoA);
        System.out.print("Enter private key for C to B: ");
        privateCtoB = sc.nextLong();
        System.out.println("C's private key c to B: " + privateCtoB);
        publicXA = power(primitiveRootG, privateA, p);
        publicYB = power(primitiveRootG, privateB, p);
        publicXC = power(primitiveRootG, privateCtoA, p);
        publicYC = power(primitiveRootG, privateCtoB, p);
        secretKeyA = power(publicYC, privateA, p);
        secretKeyB = power(publicXC, privateB, p);
        secretKeyCtoA = power(publicXA, privateCtoB, p);
        secretKeyCtoB = power(publicYB, privateCtoA, p);
        System.out.println("Public key generated by A (X): " + publicXA);
        System.out.println("Public key generated by B (Y): " + publicYB);
        System.out.println("Public key generated by C for A (X): " + publicXC);
        System.out.println("Public key generated by C for B (Y): " + publicYC);
        System.out.println("Secret key for A: " + secretKeyA);
        System.out.println("Secret key for B: " + secretKeyB);
        System.out.println("Secret key for C to A: " + secretKeyCtoA);
        System.out.println("Secret key for C to B: " + secretKeyCtoB);
    }
}
